[gcode_macro FILTER_START]
gcode:
  {% if FILAMENT_TYPE not in ("PLA", "PET", "PETG") %}
  M117 Filter { 0.3 * 100 | int }%
  SET_FAN_SPEED FAN=filter SPEED=0.3
  {% endif %}

[gcode_macro FILTER_STOP]
gcode:
  M117 Purging cancer fumes
  SET_FAN_SPEED FAN=filter SPEED=1.0
  {% if not printer.heater_bed.target | float %}
  TEMPERATURE_WAIT SENSOR=heater_bed MAXIMUM=50
  M117 Done purging
  SET_FAN_SPEED FAN=filter SPEED=0.0
  {% endif %}
